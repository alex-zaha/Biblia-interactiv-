<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Biblia Pro - BazƒÉ de Date Live</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Lora:wght@400;600&display=swap" rel="stylesheet">
    
    <script src="data/cornilescu.js"></script>

    <style>
        :root { --p: #1a2a6c; --a: #b21f1f; --s: #28a745; }
        body, html { background: #f4f7f6; margin: 0; padding: 0; font-family: 'Lora', serif; }
        header { background: white; padding: 12px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .nav-custom { background: white; border-radius: 50px; padding: 3px; display: inline-flex; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin: 15px auto; }
        .nav-link { border-radius: 50px !important; font-weight: bold; color: #666; padding: 7px 15px !important; font-size: 0.8rem; }
        .nav-link.active { background: var(--p) !important; color: white !important; }
        .card-premium { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .quiz-btn { padding: 12px !important; margin-bottom: 10px; border-radius: 12px !important; width: 100%; transition: 0.3s; border: 2px solid #eee; font-weight: bold !important; background: white; }
        #q-txt { font-family: 'Montserrat', sans-serif; font-weight: 700; color: #2c3e50; min-height: 60px; text-align: center; font-size: 1.1rem; }
        .ref-hint { font-size: 0.9rem; color: #d32f2f; font-style: italic; margin-top: 8px; display: block; font-weight: bold; }
    </style>
</head>
<body>

<header>
    <h6 style="color: var(--p); font-family: 'Montserrat'; margin: 0; font-weight: 800;">BIBLIA <span style="color: var(--a);">PRO</span></h6>
</header>

<div class="container py-2 text-center">
    <div class="nav-custom shadow-sm">
        <ul class="nav nav-pills" id="pills-tab">
            <li class="nav-item"><button class="nav-link active" data-bs-toggle="pill" data-bs-target="#daily">ASTƒÇZI</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#read" onclick="initRead()">CITIRE</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#quiz">QUIZ</button></li>
        </ul>
    </div>

    <div class="tab-content text-start">
        <div class="tab-pane fade show active" id="daily">
            <div class="card-premium text-center">
                <p id="rand-text" style="font-size: 1.25rem;">Se √ÆncarcƒÉ...</p>
                <h6 id="rand-ref" class="fw-bold mt-2" style="color: var(--p);"></h6>
                <button onclick="genereazaVerset()" class="btn btn-sm btn-primary rounded-pill mt-3 px-4 shadow-sm">ALT VERSET</button>
            </div>
        </div>

        <div class="tab-pane fade" id="read">
            <div class="card-premium p-2 mb-2 sticky-top">
                <div class="d-flex gap-1">
                    <select id="sel-c" class="form-select form-select-sm" onchange="updateCap()"></select>
                    <select id="sel-cap" class="form-select form-select-sm" onchange="showCap()"></select>
                </div>
            </div>
            <div id="citire-text" class="card-premium">SelecteazƒÉ o carte...</div>
        </div>

        <div class="tab-pane fade" id="quiz">
            <div id="quiz-login" class="card-premium text-center">
                <h6 class="fw-bold mb-3">Introdu numele tƒÉu</h6>
                <input type="text" id="user-name" class="form-control mb-3 shadow-sm text-center" placeholder="Numele tƒÉu">
                <button onclick="startQuizFlow()" class="btn btn-primary w-100 rounded-pill fw-bold">√éNCEPE JOCUL</button>
            </div>

            <div id="quiz-box" class="card-premium d-none">
                <div class="d-flex justify-content-between mb-3 small text-muted border-bottom pb-2">
                    <span id="player-display" class="fw-bold text-primary"></span>
                    <span id="score-display" class="fw-bold text-success">Scor: 0</span>
                </div>
                <div id="q-txt"></div>
                <div id="q-opts" class="d-grid mt-3"></div>
                <div id="q-res" class="text-center fw-bold mt-3" style="min-height: 80px;"></div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- DATE QUIZ ---
    const intrebariBiblice = [
        { q: "Cine l-a trƒÉdat pe Isus pentru 30 de argin»õi?", a: ["Iuda Iscarioteanul", "Petru", "Ioan", "Toma"], c: 0, r: "Matei 26:14-16" },
        { q: "Unde S-a nƒÉscut Isus Hristos?", a: ["Ierusalim", "Nazaret", "Betleem", "Ierihon"], c: 2, r: "Matei 2:1" },
        { q: "Moise a despƒÉr»õit apele MƒÉrii Ro»ôii.", a: ["AdevƒÉrat", "Fals"], c: 0, r: "Exod 14:21-22" },
        { q: "C√¢te zile a plouat √Æn timpul potopului lui Noe?", a: ["7 zile", "12 zile", "40 de zile", "100 de zile"], c: 2, r: "Geneza 7:12" },
        { q: "Care a fost prima minune a lui Isus?", a: ["Vindecarea", "P√¢inile", "Apa √Æn vin", "Mersul pe apƒÉ"], c: 2, r: "Ioan 2:11" },
        { q: "Cine l-a ucis pe uria»ôul Goliat?", a: ["Saul", "David", "Samson", "Ghedeon"], c: 1, r: "1 Samuel 17:50" }
    ];

    // --- CONFIGURARE SUPABASE ---
    const SUPABASE_URL = "https://tlfvklpexmglgkhuxyxp.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRsZnZrbHBleG1nbGdraHV4eXhwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4NjIxMjgsImV4cCI6MjA4NzQzODEyOH0.Vj7b_VsE9jCU5j3vW7EaOb2MGeWL8cbYPkkI3kuPeMY";

    let userName = "";
    let score = 0;
    let quizBlocat = false;

    function genereazaVerset() {
        if (typeof bibleData !== 'undefined') {
            const v = bibleData.verses[Math.floor(Math.random() * bibleData.verses.length)];
            document.getElementById('rand-text').innerText = v.text;
            document.getElementById('rand-ref').innerText = v.book_name + " " + v.chapter + ":" + v.verse;
        }
    }
    window.onload = genereazaVerset;

    function startQuizFlow() {
        const input = document.getElementById('user-name');
        if(input.value.trim().length < 2) return;
        userName = input.value;
        document.getElementById('quiz-login').classList.add('d-none');
        document.getElementById('quiz-box').classList.remove('d-none');
        document.getElementById('player-display').innerText = "üë§ " + userName;
        startQuiz();
    }

    async function trimiteDate(intrebare, rezultat) {
        const payload = { nume: userName, intrebare: intrebare, rezultat: rezultat };
        try {
            const res = await fetch(`${SUPABASE_URL}/rest/v1/scoruri`, {
                method: "POST",
                headers: {
                    "apikey": SUPABASE_KEY,
                    "Authorization": `Bearer ${SUPABASE_KEY}`,
                    "Content-Type": "application/json",
                    "Prefer": "return=minimal"
                },
                body: JSON.stringify(payload)
            });
            console.log("Status trimitere:", res.status);
        } catch (e) { console.error("Eroare trimitere:", e); }
    }

    function startQuiz() {
        quizBlocat = false;
        const intr = intrebariBiblice[Math.floor(Math.random() * intrebariBiblice.length)];
        const indexCorect = intr.c;
        const raspunsCorect = intr.a[indexCorect];
        
        document.getElementById('q-txt').innerText = intr.q;
        document.getElementById('q-res').innerText = "";
        const od = document.getElementById('q-opts');
        od.innerHTML = "";
        
        intr.a.forEach((raspuns, index) => {
            let b = document.createElement('button');
            b.className = "quiz-btn";
            b.innerText = raspuns;
            b.onclick = () => {
                if(quizBlocat) return;
                quizBlocat = true;
                
                let statusR = (index === indexCorect) ? "Corect" : "Gresit";
                if(index === indexCorect) {
                    score++;
                    b.style.borderColor = "var(--s)";
                    b.style.color = "var(--s)";
                    document.getElementById('q-res').innerHTML = `<div class="text-success">CORECT! ‚úÖ</div><span class="ref-hint">Ref: ${intr.r}</span>`;
                } else {
                    b.style.borderColor = "var(--a)";
                    b.style.color = "var(--a)";
                    document.getElementById('q-res').innerHTML = `<div class="text-danger">GRESIT! (Era: ${raspunsCorect}) ‚ùå</div><span class="ref-hint">Referin»õa: ${intr.r}</span>`;
                }
                
                document.getElementById('score-display').innerText = "Scor: " + score;
                trimiteDate(intr.q, statusR);
                setTimeout(startQuiz, 3500);
            };
            od.appendChild(b);
        });
    }

    function initRead() {
        const sc = document.getElementById('sel-c');
        if (sc.options.length > 0) return;
        const carti = [...new Set(bibleData.verses.map(v => v.book_name))];
        carti.forEach(c => sc.add(new Option(c, c)));
        updateCap();
    }
    function updateCap() {
        const c = document.getElementById('sel-c').value;
        const caps = [...new Set(bibleData.verses.filter(v => v.book_name === c).map(v => v.chapter))];
        const sc = document.getElementById('sel-cap');
        sc.innerHTML = "";
        caps.forEach(cp => sc.add(new Option("Cap. " + cp, cp)));
        showCap();
    }
    function showCap() {
        const c = document.getElementById('sel-c').value;
        const cp = document.getElementById('sel-cap').value;
        const vers = bibleData.verses.filter(v => v.book_name === c && v.chapter == cp);
        document.getElementById('citire-text').innerHTML = vers.map(v => `<span><small style="color:red; font-size:0.7rem;">${v.verse}</small> ${v.text} </span>`).join('');
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
