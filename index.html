<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Biblia Pro - Versiunea Finală</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Lora:wght@400;600&display=swap" rel="stylesheet">
    
    <script src="data/cornilescu.js"></script>

    <style>
        :root { --p: #1a2a6c; --a: #d32f2f; }
        body { background: #f4f7f6; font-family: sans-serif; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        header { background: white; padding: 10px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .main-content { flex: 1; overflow-y: auto; padding: 15px; }

        .nav-custom { background: white; border-radius: 50px; padding: 5px; display: inline-flex; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .nav-link { border-radius: 50px !important; font-weight: bold; color: #666; padding: 8px 20px !important; }
        .nav-link.active { background: var(--p) !important; color: white !important; }

        .card-premium { background: white; border-radius: 25px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        #rand-text { font-family: 'Lora', serif; font-size: 1.4rem; color: #2c3e50; line-height: 1.6; }
        
        #citire-text { font-family: 'Lora', serif; font-size: 1.25rem; text-align: justify; background: white; padding: 20px; border-radius: 15px; }
        .verse-num { color: var(--p); font-weight: 800; font-size: 0.8rem; margin-right: 8px; background: #eee; padding: 2px 5px; border-radius: 4px; }
        .highlight { background: #fff3cd; border-radius: 4px; }

        .btn-home-float { position: fixed; bottom: 20px; right: 20px; background: var(--p); color: white; border: none; border-radius: 50%; width: 55px; height: 55px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 1000; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        
        /* Stiluri Quiz */
        .quiz-btn { transition: all 0.2s ease; border-width: 2px !important; }
        .quiz-btn:disabled { opacity: 1; color: white !important; }
    </style>
</head>
<body>

<header>
    <h5 style="color: var(--p); font-family: 'Montserrat'; margin: 0;">BIBLIA <span style="color: var(--a);">PRO</span></h5>
</header>

<div class="main-content text-center">
    
    <div class="nav-custom shadow-sm mt-2">
        <ul class="nav nav-pills" id="pills-tab" role="tablist">
            <li class="nav-item"><button class="nav-link active" id="tab1" data-bs-toggle="pill" data-bs-target="#daily">ASTĂZI</button></li>
            <li class="nav-item"><button class="nav-link" id="tab2" data-bs-toggle="pill" data-bs-target="#read" onclick="initRead()">CITIRE</button></li>
            <li class="nav-item"><button class="nav-link" id="tab3" data-bs-toggle="pill" data-bs-target="#quiz" onclick="startQuiz()">QUIZ</button></li>
        </ul>
    </div>

    <div class="tab-content text-start">
        <div class="tab-pane fade show active" id="daily">
            <div class="card-premium text-center">
                <i class="fas fa-quote-left fa-2x mb-3" style="color: var(--p); opacity: 0.2;"></i>
                <p id="rand-text">Se încarcă cuvântul zilei...</p>
                <h5 id="rand-ref" class="fw-bold mt-3" style="color: var(--p);"></h5>
                <button onclick="genereazaVerset()" class="btn btn-primary rounded-pill mt-4 px-5 shadow">VERSET NOU</button>
            </div>
        </div>

        <div class="tab-pane fade" id="read">
            <div class="bg-white p-2 rounded-4 mb-3 shadow-sm d-flex gap-1 sticky-top">
                <select id="sel-c" class="form-select form-select-sm border-0 bg-light" onchange="updateCap()"></select>
                <select id="sel-cap" class="form-select form-select-sm border-0 bg-light" onchange="showCap()"></select>
                <select id="sel-v" class="form-select form-select-sm border-0 bg-light" onchange="goToV()"></select>
            </div>
            <div id="citire-text">Selectează o carte...</div>
        </div>

        <div class="tab-pane fade" id="quiz">
            <div class="card-premium">
                <h6 class="text-center fw-bold mb-4">UNDE SE AFLĂ ACEST VERSET?</h6>
                <div id="q-txt" class="p-3 bg-light rounded-4 mb-4 text-center" style="font-family: 'Lora'; min-height: 80px;"></div>
                <div id="q-opts" class="d-grid gap-2"></div>
                <div id="q-res" class="text-center mt-3 fw-bold fs-5"></div>
            </div>
        </div>
    </div>
</div>

<button class="btn-home-float" onclick="goHome()"><i class="fas fa-home"></i></button>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    window.onload = function() {
        setTimeout(genereazaVerset, 600);
    };

    function goHome() {
        bootstrap.Tab.getOrCreateInstance(document.getElementById('tab1')).show();
        genereazaVerset();
    }

    function genereazaVerset() {
        if (typeof bibleData !== 'undefined' && bibleData.verses) {
            const v = bibleData.verses[Math.floor(Math.random() * bibleData.verses.length)];
            document.getElementById('rand-text').innerText = v.text;
            document.getElementById('rand-ref').innerText = v.book_name + " " + v.chapter + ":" + v.verse;
        }
    }

    // --- LOGICA CITIRE ---
    function initRead() {
        const sc = document.getElementById('sel-c');
        if (sc.options.length > 0) return;
        const carti = [...new Set(bibleData.verses.map(v => v.book_name))];
        carti.forEach(c => sc.add(new Option(c, c)));
        updateCap();
    }

    function updateCap() {
        const c = document.getElementById('sel-c').value;
        const caps = [...new Set(bibleData.verses.filter(v => v.book_name === c).map(v => v.chapter))];
        const sc = document.getElementById('sel-cap');
        sc.innerHTML = "";
        caps.forEach(cp => sc.add(new Option("Cap. " + cp, cp)));
        showCap();
    }

    function showCap() {
        const c = document.getElementById('sel-c').value;
        const cp = parseInt(document.getElementById('sel-cap').value);
        const vers = bibleData.verses.filter(v => v.book_name === c && v.chapter === cp);
        const cont = document.getElementById('citire-text');
        let htmlContent = "";
        vers.forEach(v => {
            htmlContent += `<span id="v-${v.verse}"><span class="verse-num">${v.verse}</span>${v.text} </span>`;
        });
        cont.innerHTML = htmlContent;
        const sv = document.getElementById('sel-v');
        sv.innerHTML = '<option value="0">Sări la v...</option>';
        vers.forEach(v => sv.add(new Option("v. " + v.verse, v.verse)));
    }

    function goToV() {
        const v = document.getElementById('sel-v').value;
        if(v == 0) return;
        document.querySelectorAll('[id^="v-"]').forEach(el => el.classList.remove('highlight'));
        const target = document.getElementById('v-' + v);
        if(target) {
            target.classList.add('highlight');
            target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }

    // --- LOGICA QUIZ (REPARATĂ) ---
    let ok = "";
    let quizBlocat = false;

    function startQuiz() {
        quizBlocat = false;
        const v = bibleData.verses[Math.floor(Math.random() * bibleData.verses.length)];
        ok = v.book_name + " " + v.chapter + ":" + v.verse;
        
        document.getElementById('q-txt').innerText = `"${v.text}"`;
        document.getElementById('q-res').innerText = "";
        
        let o = [ok];
        while(o.length < 4) {
            let rx = bibleData.verses[Math.floor(Math.random() * bibleData.verses.length)];
            let ref = rx.book_name + " " + rx.chapter + ":" + rx.verse;
            if(!o.includes(ref)) o.push(ref);
        }
        o.sort(() => Math.random() - 0.5);
        
        const od = document.getElementById('q-opts');
        od.innerHTML = "";
        
        o.forEach(x => {
            let b = document.createElement('button');
            b.className = "btn btn-outline-primary p-3 rounded-4 fw-bold shadow-sm bg-white quiz-btn";
            b.innerText = x;
            
            b.onclick = () => {
                if(quizBlocat) return;
                quizBlocat = true;
                
                // Dezactivăm butoanele vizual
                const toateButoanele = od.querySelectorAll('button');
                
                if(x === ok) {
                    b.classList.replace('btn-outline-primary', 'btn-success');
                    b.classList.remove('bg-white');
                    document.getElementById('q-res').innerHTML = "<span class='text-success'>CORECT! ✅</span>";
                } else {
                    b.classList.replace('btn-outline-primary', 'btn-danger');
                    b.classList.remove('bg-white');
                    document.getElementById('q-res').innerHTML = `<span class='text-danger'>GREȘIT! ERA ${ok} ❌</span>`;
                    
                    // Arătăm și care era cel corect
                    toateButoanele.forEach(btn => {
                        if(btn.innerText === ok) {
                            btn.classList.replace('btn-outline-primary', 'btn-success');
                            btn.classList.remove('bg-white');
                        }
                    });
                }
                
                // Următoarea întrebare după 2 secunde
                setTimeout(startQuiz, 2000);
            };
            od.appendChild(b);
        });
    }
</script>
</body>
</html>
